<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>App Flask + Ionic</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <!-- Ionic CSS -->
  <link href="https://cdn.jsdelivr.net/npm/@ionic/core/css/ionic.bundle.css" rel="stylesheet" />

  <!-- Ionic JS -->
  <script type="module" src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.esm.js"></script>
  <script nomodule src="https://cdn.jsdelivr.net/npm/@ionic/core/dist/ionic/ionic.js"></script>

  <style>
    ion-content {
      padding: 16px;
    }
  </style>
</head>
<body>
  <ion-app>
    <!-- Menú lateral -->
    <ion-menu side="start" content-id="main-content">
      <ion-header>
        <ion-toolbar color="primary">
          <ion-title>Menú</ion-title>
        </ion-toolbar>
      </ion-header>
      <ion-content>
        <ion-list>
          <ion-item button onclick="mostrarInicio()">Inicio</ion-item>
          <ion-item button onclick="mostrarIMC()">Calculadora IMC</ion-item>
          <ion-item button onclick="mostrarRenta()">Declaración Renta</ion-item>
        </ion-list>
      </ion-content>
    </ion-menu>

    <!-- Contenido principal -->
    <div class="ion-page" id="main-content">
      <ion-header>
        <ion-toolbar color="primary">
          <ion-buttons slot="start">
            <ion-menu-button></ion-menu-button>
          </ion-buttons>
          <ion-title id="titulo">Inicio</ion-title>
        </ion-toolbar>
      </ion-header>

      <ion-content id="contenido">
        <h2>Bienvenido</h2>
        <p>Usa el menú para navegar.</p>
      </ion-content>

      <ion-footer>
        <ion-toolbar color="light">
          <ion-title size="small">© 2025 Proyecto Flask + Ionic</ion-title>
        </ion-toolbar>
      </ion-footer>
    </div>
  </ion-app>

  <script>
    function mostrarInicio() {
      document.getElementById("titulo").textContent = "Inicio";
      document.getElementById("contenido").innerHTML = `
        <h2>Bienvenido</h2>
        <p>Usa el menú lateral para abrir las calculadoras.</p>
      `;
      document.querySelector("ion-menu").close();
    }

    function mostrarIMC() {
      document.getElementById("titulo").textContent = "Calculadora IMC";
      document.getElementById("contenido").innerHTML = `
        <ion-item>
          <ion-input id="peso" type="number" placeholder="Peso (kg)"></ion-input>
        </ion-item>
        <ion-item>
          <ion-input id="altura" type="number" placeholder="Altura (m)"></ion-input>
        </ion-item>
        <ion-button expand="block" onclick="calcularIMC()">Calcular</ion-button>
        <ion-card id="resultadoIMC" style="display:none; margin-top: 20px;">
          <ion-card-header><ion-card-title>Resultado</ion-card-title></ion-card-header>
          <ion-card-content id="imcValor"></ion-card-content>
        </ion-card>
      `;
      document.querySelector("ion-menu").close();
    }

    async function calcularIMC() {
      const peso = parseFloat(document.getElementById("peso").value);
      const altura = parseFloat(document.getElementById("altura").value);

      if (!peso || !altura || altura <= 0) {
        alert("Por favor, ingresa peso y altura válidos.");
        return;
      }

      try {
        const res = await fetch("http://127.0.0.1:5000/api/imc", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ peso, altura }),
        });

        if (!res.ok) {
          const errorData = await res.json();
          alert("Error: " + (errorData.error || "Problema al calcular IMC"));
          return;
        }

        const data = await res.json();
        document.getElementById("resultadoIMC").style.display = "block";
        document.getElementById("imcValor").textContent =
          `Tu IMC es: ${data.imc} (${data.categoria})`;
      } catch (error) {
        alert("Error en la conexión con el servidor.");
      }
    }

    function mostrarRenta() {
      document.getElementById("titulo").textContent = "Declaración Renta";
      document.getElementById("contenido").innerHTML = `
        <ion-item>
          <ion-input id="patrimonio" type="number" placeholder="Patrimonio bruto 2024"></ion-input>
        </ion-item>
        <ion-item>
          <ion-input id="ingresos" type="number" placeholder="Ingresos brutos 2024"></ion-input>
        </ion-item>
        <ion-item>
          <ion-input id="tarjetas" type="number" placeholder="Consumo con tarjeta de crédito"></ion-input>
        </ion-item>
        <ion-item>
          <ion-input id="compras" type="number" placeholder="Compras o consumos"></ion-input>
        </ion-item>
        <ion-item>
          <ion-input id="consignaciones" type="number" placeholder="Consignaciones bancarias"></ion-input>
        </ion-item>
        <ion-button expand="block" onclick="calcularRenta()">Calcular</ion-button>
        <ion-card id="resultadoRenta" style="display:none; margin-top: 20px;">
          <ion-card-header><ion-card-title>Resultado</ion-card-title></ion-card-header>
          <ion-card-content id="rentaValor"></ion-card-content>
        </ion-card>
      `;
      document.querySelector("ion-menu").close();
    }

    async function calcularRenta() {
      const patrimonio = parseInt(document.getElementById("patrimonio").value) || 0;
      const ingresos = parseInt(document.getElementById("ingresos").value) || 0;
      const tarjetas = parseInt(document.getElementById("tarjetas").value) || 0;
      const compras = parseInt(document.getElementById("compras").value) || 0;
      const consignaciones = parseInt(document.getElementById("consignaciones").value) || 0;

      try {
        const res = await fetch("http://127.0.0.1:5000/api/renta", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ patrimonio, ingresos, tarjetas, compras, consignaciones }),
        });

        if (!res.ok) {
          const errorData = await res.json();
          alert("Error: " + (errorData.error || "Problema al calcular renta"));
          return;
        }

        const data = await res.json();
        document.getElementById("resultadoRenta").style.display = "block";
        document.getElementById("rentaValor").textContent = data.resultado;
      } catch (error) {
        alert("Error en la conexión con el servidor.");
      }
    }
  </script>
</body>
</html>
